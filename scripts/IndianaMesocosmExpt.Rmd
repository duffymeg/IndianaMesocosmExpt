---
title: "Indiana Mesocosm Experiment"
author: "Laura Lopez & Meghan Duffy"
date: "23/04/2021 & Jan-June 2022"
output:
  word_document: default
  pdf_document: default
---
#loading packages
```{r,message=F,warning=F}
library(Hmisc)
library(tidyverse)
library(RColorBrewer)
library(lsmeans)
library(ggsignif)
library(here)
library(cowplot)
library(multcomp)
library(multcompView)
library(lme4)
library(nlme)

theme_set(theme_cowplot(font_size = 14))
```

#loading files

```{r,message=F,warning=F}
# Tell R where files are stored
here::i_am("scripts/IndianaMesocosmExpt.Rmd")

# Load the data
indianadata<-readr::read_csv(here("data/indianadatano22.csv"))
indianadata$chaoborusfactor<-as.factor(indianadata$chaoborus)
summary(indianadata)

#Fix issue with weeks, so that they line up with this timeline:
#week 0 = Daphnia added
#week 1 = spores added
#weeks 2-9 = sampling
indianadata$time <- indianadata$time + 1

#Subset data
indianadatametsch <- indianadata %>%
  filter(metsch == "Parasites")

```

# Infections

### Plot
```{r, plotting infection prevalence}
propinfovertimeplot<-ggplot(indianadatametsch,aes(time,y=propinfected,group=chaoborusfactor,color=chaoborusfactor,shape=chaoborusfactor)) +
  stat_summary(fun="mean",geom="line",size=1,show.legend=FALSE) +
  stat_summary(fun.data = "mean_cl_boot",show.legend=FALSE) +
  stat_summary(fun="mean",geom="point",size=3) +
  scale_shape_manual(values=c(15,16,17,18)) +
  labs(color="Predator density \n(per L)", shape = "Predator density \n(per L)") +
  scale_colour_manual(values=c("#6baed6", "#3182bd", "#08519c","black")) +
  theme_bw()+theme(panel.grid = element_blank()) +
  theme(legend.position = c(0.25, 0.75)) +
  theme(legend.background = element_rect(size=0.25, linetype="solid", 
                                  colour ="darkgray")) +
  theme(legend.key.size = unit(0.05, 'cm'), legend.title = element_text(size=10), #change legend title font size
        legend.text = element_text(size=8)) +
  labs(x="Time (weeks)")+labs(y="Proportion infected") +
  scale_x_discrete(limits=c("1", "2","3","4","5","6","7","8","9"))
propinfovertimeplot

ggsave(here("figures", "propinfovertimeplot.jpg"), propinfovertimeplot, units = "in", width = 6, height = 4, dpi = 300)

#density of infected hosts
infdensityovertimeplot<-ggplot(indianadatametsch,aes(time,y=lndensityinfected,group=chaoborusfactor,color=chaoborusfactor,shape=chaoborusfactor)) +
  stat_summary(fun="mean",geom="line",size=1, show.legend = FALSE) +
  stat_summary(fun.data = "mean_cl_boot",show.legend=FALSE) + 
  stat_summary(fun="mean",geom="point",size=2,aes(shape=chaoborusfactor),show.legend=FALSE) +
  scale_shape_manual(values=c(15,16,17,18)) +
#  labs(color="Predator density \n(per L)") + 
  scale_colour_manual(values=c("#6baed6", "#3182bd", "#08519c","black")) + 
  theme_bw()+theme(panel.grid = element_blank()) + 
  labs(x="Time (weeks)") +
  labs(y="LN infected prey density \n(per L)") + 
  scale_x_discrete(limits=c("1", "2","3","4","5","6","7","8","9")) 
infdensityovertimeplot

inftimeseriesplot <- plot_grid(propinfovertimeplot, infdensityovertimeplot, labels = "auto", ncol = 1, align = "v")
inftimeseriesplot

ggsave(here("figures", "inftimeseriesplot.jpg"), inftimeseriesplot, units = "in", width = 4, height = 5.5, dpi = 300)

```

### Figuring out error bars at time 3
```{r, error bars for LN infected density plot}
time3metschdata <- indianadatametsch %>%
  filter(time == 3) %>%
  filter(metsch == "Parasites")

time3metschdata_summary <- time3metschdata %>%
  group_by(chaoborusfactor) %>%
  summarise(meaninfdensity = mean(lndensityinfected), mininfdensity = min(lndensityinfected), maxinfdensity = max(lndensityinfected)) 

time3metschdata_summary
```


### Summarizing data for reporting values in manuscript
```{r, summarizing infection prevalence data}
indianadatametsch$totalinfected <- indianadatametsch$adultsinfected + indianadatametsch$juvenilesinfected
indianadatametsch$totaluninfected <- indianadatametsch$adultsnotinfected + indianadatametsch$juvenilesnotinfected

# remove time 0 for analysis
indianadatametschanalysis <- indianadatametsch %>%
  filter(time > 0.5)

indiana_infected_summary <- indianadatametschanalysis %>%
  group_by(time, chaoborusfactor) %>%
  summarise(meanpropinf = mean(propinfected), minpropinf = min(propinfected), maxpropinf = max(propinfected),  meaninfdensity = mean(totalinfected), mininfdensity = min(totalinfected), maxinfdensity = max(totalinfected)) 

indiana_infected_summary
```


### Analysis -- note: this was abandoned in favor of analyzing AUC data
```{r, analysis of infection prevalence over time}
prevmodel1<-glm(cbind(totalinfected, totaluninfected) ~ chaoborus + (1|time), family=binomial(logit), data=indianadatametschanalysis) 
anova(prevmodel1, test="Chisq")
summary(prevmodel1)

# Testing for overdispersion (using code from Ben Bolker via Michelle Fearon)
overdisp_fun <- function(model) {
  rdf <- df.residual(model)
  rp <- residuals(model,type="pearson")
  Pearson.chisq <- sum(rp^2)
  prat <- Pearson.chisq/rdf
  pval <- pchisq(Pearson.chisq, df=rdf, lower.tail=FALSE)
  c(chisq=Pearson.chisq,ratio=prat,rdf=rdf,p=pval)
}

overdisp_fun(prevmodel1)
# super overdispersed, going to focus on integrated prevalence instead

```

## Integrated infection prevalence

```{r, integrated infection prevalence analysis and plotting}
infectedAUC<-readr::read_csv(here("data/infected1to8.csv"))
infectedAUC$chaoborus<-as.factor(infectedAUC$chaoborus)
summary(infectedAUC)
aov1<-aov(infprevAUC~chaoborus,data=infectedAUC)
summary(aov1)
lsmeans(aov1,pairwise~chaoborus,adjust="tukey")


ph <- glht(aov1, linfct = mcp(chaoborus = "Tukey"))
CLD<-cld(ph)
old.par <- par(mai=c(1,1,1.25,1), no.readonly = TRUE)
plot(CLD)
par(old.par)


intinfprevplot <- ggplot(aov1,aes(x=chaoborus,y=infprevAUC,color=chaoborus)) +
  geom_boxplot(show.legend=FALSE) +
  geom_jitter(shape=17, position=position_jitter(width=0.2, height=0), alpha = 0.5, color = '#787878', size = 2) +
  labs(x="Predator density (per L)",y="Integrated \ninfection prevalence") +
  scale_color_manual(values=c("#6baed6", "#3182bd", "#08519c","black")) +
  theme_bw() +
  geom_text(data=aov1,x=1,y=1.4,label = "a", color = "black", size = 3) +
  geom_text(data=aov1,x=2,y=1.4,label = "a,b", color = "black",size = 3) +
  geom_text(data=aov1,x=3,y=1.4,label = "b,c", color = "black",size = 3) +
  geom_text(data=aov1,x=4,y=1.4,label = "c", color = "black",size = 3) +
  ylim(0.0,1.5) + 
  theme(panel.grid=element_blank())

intinfprevplot

```


## Integrated infected host density

```{r, integrated infected host density analysis and plotting}
aov2<-aov(loginfdensityAUC~chaoborus,data=infectedAUC)
summary(aov2)
lsmeans(aov2,pairwise~chaoborus,adjust="tukey")


ph <- glht(aov2, linfct = mcp(chaoborus = "Tukey"))
CLD<-cld(ph)
old.par <- par(mai=c(1,1,1.25,1), no.readonly = TRUE)
plot(CLD)
par(old.par)


intinfhostplot <- ggplot(aov2,aes(x=chaoborus,y=loginfdensityAUC,color=chaoborus)) +
  geom_boxplot(show.legend=FALSE) +
  geom_jitter(shape=17, position=position_jitter(width=0.2, height=0), alpha = 0.5, color = '#787878', size = 2) +
  labs(x="Predator density (per L)",y="Integrated infected \nprey density") +
  scale_color_manual(values=c("#6baed6", "#3182bd", "#08519c","black")) +
  theme_bw() +
  geom_text(data=aov2,x=1,y=11,label = "a", color = "black", size = 3) +
  geom_text(data=aov2,x=2,y=11,label = "a,b", color = "black",size = 3) +
  geom_text(data=aov2,x=3,y=11,label = "b", color = "black",size = 3) +
  geom_text(data=aov2,x=4,y=11,label = "c", color = "black",size = 3) +
  ylim(0.0,12.0) + 
  theme(panel.grid=element_blank())

intinfhostplot

```

## Making one combined plot for figure 1
```{r, plot combining infection prevalence and infected density}
figure1 <- plot_grid(propinfovertimeplot, intinfprevplot, infdensityovertimeplot, intinfhostplot, labels = "auto", ncol = 2, align = "v")
figure1

ggsave(here("figures", "figure1.jpg"), figure1, units = "in", width = 7, height = 5.5, dpi = 300)
```


# Population density

```{r, population size over time}
indianadata$metsch <- as.factor(indianadata$metsch)

figure2parta <- ggplot(indianadata, aes(x = time, y = (logone), color = chaoborusfactor, group = chaoborusfactor, shape = chaoborusfactor)) + 
  stat_summary(fun = "mean", geom="line", aes(group = chaoborusfactor)) + 
  stat_summary(fun.data="mean_cl_boot") +
  facet_grid(rows=vars(metsch)) +
  labs(x="Time(week)",y="Log (prey density + 1) \n(per L)") + 
  scale_x_discrete(limits=c("1", "2","3","4","5","6","7","8","9")) + 
  scale_color_manual(values=c("#6baed6", "#3182bd", "#08519c","black")) +
    scale_shape_manual(values=c(15,16,17,18)) +
  labs(color="Predator density \n(per L)", shape = "Predator density \n(per L)") +
  theme_bw()+theme(panel.grid = element_blank())

figure2parta


# ggsave(here("figures", "figure2.jpg"), figure2, units = "in", width = 6, height = 4, dpi = 300)

```


# Integrated infected host density

```{r, integrated infected host density analysis}
densityAUC<-readr::read_csv(here("data/integratedtotaldensities1to8.csv"))
densityAUC$chaoborus<-as.factor(densityAUC$chaoborus)
summary(densityAUC)

aov3<-aov(integration~chaoborus*metsch,data=densityAUC)
summary(aov3)
lsmeans(aov3,pairwise~chaoborus,adjust="tukey")
lsmeans(aov3,pairwise~chaoborus*metsch,adjust="tukey")

# curious about whether there's an effect of Metsch for no predation treatment
densityAUCnopred <- densityAUC %>%
  filter(chaoborus == 0)


aov3nopred<-aov(integration~metsch,data=densityAUC)
summary(aov3nopred)

#ph <- glht(aov3, linfct = mcp(chaoborus = "Tukey"))
#CLD<-cld(ph)
#old.par <- par(mai=c(1,1,1.25,1), no.readonly = TRUE)
#plot(CLD)
#par(old.par)
```

```{r, integrated prey density plot}
intdensityplot <- ggplot(aov3,aes(x=chaoborus,y=integration, color=chaoborus, fill = metsch)) +
  geom_boxplot(lwd=0.75) +
  geom_point(pch=17, position=position_jitterdodge(jitter.width = 0.2), alpha = 0.5, size = 2, color = 'black',show.legend=FALSE) +
  labs(x="Predator density (per L)",y="Integrated \nprey density") +
  labs(color = "Predator density \n(per L)", fill = "Parasite treatment") +
  scale_color_manual(values=c("#6baed6", "#3182bd", "#08519c","black"), guide="none") +
  scale_fill_manual(values=c('gray','white')) +
  theme_bw() +   
  geom_text(data=aov3,x=1,y=31,label = "a        a", color = "black", size = 3) +
  geom_text(data=aov3,x=2,y=31,label = "a        a", color = "black",size = 3) +
  geom_text(data=aov3,x=3,y=31,label = "a        a", color = "black",size = 3) +
  geom_text(data=aov3,x=4,y=31,label = "b        b", color = "black",size = 3) +
  ylim(0.0,32.0) + 
  theme(panel.grid=element_blank())

intdensityplot


```


## Making one combined plot for figure 2
```{r, plot combining density and integrated density}
figure2 <- plot_grid(figure2parta, intdensityplot, labels = "auto", ncol = 1, 
                 rel_heights = c(2, 1))
figure2

ggsave(here("figures", "figure2.jpg"), figure2, units = "in", width = 6, height = 5, dpi = 300)
```


# Egg ratio

```{r, egg ratio data}
eggs<-readr::read_csv(here("data/eggdata.csv"))
eggs$pred<-as.factor(eggs$pred)
#fixing week issue -- need to add 1 to all of these to have the weeks consistent across the different analyses
eggs$time<-eggs$time+1
eggs$time<-as.factor(eggs$time)

summary(eggs)

eggs$metsch <- factor(eggs$para, levels = c("metsch", "no metsch"),
                  labels = c("Parasites", "No parasites"))

eggs$metsch <- factor(eggs$metsch, c("No parasites", "Parasites"))

eggplot <- ggplot(eggs,aes(time,y=eggs,group=pred,color=pred,shape=pred)) + 
  stat_summary(fun="mean",geom="line",size=1,show.legend=FALSE) +
  stat_summary(fun.data = "mean_cl_boot",show.legend=FALSE) + 
  stat_summary(fun="mean",geom="point",size=2,aes(shape=pred)) + 
  scale_shape_manual(values=c(15,16,17,18)) + 
  labs(color="Predator\ndensity (per L)", shape = "Predator\ndensity (per L)") + 
  scale_colour_manual(values=c("#6baed6", "#3182bd", "#08519c","black")) +  
  theme_bw()+theme(panel.grid = element_blank()) + 
  labs(x="Time (weeks)")+labs(y="Egg ratio \n(embryos per uninfected adult)") + 
  theme(axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0))) +
  theme(axis.title.x=element_text(margin=margin(t=10,r=0,b=0,l=0))) + 
  facet_grid(rows=vars(metsch))
eggplot

```

```{r, analysis of egg ratio data}
#challenge: didn't have enough adults to do egg ratios in high predation + Metsch treatment tanks in weeks 3 & 5

week3eggdata <- eggs %>%
  filter(time == 4)

eggaov1 <- aov(eggs~pred*metsch,data=week3eggdata)
summary(eggaov1)

# Testing for overdispersion (using code from Ben Bolker via Michelle Fearon)
overdisp_fun <- function(model) {
  rdf <- df.residual(model)
  rp <- residuals(model,type="pearson")
  Pearson.chisq <- sum(rp^2)
  prat <- Pearson.chisq/rdf
  pval <- pchisq(Pearson.chisq, df=rdf, lower.tail=FALSE)
  c(chisq=Pearson.chisq,ratio=prat,rdf=rdf,p=pval)
}

overdisp_fun(eggaov1)
# not overdispersed!
```

# Chlorophyll

```{r, chlorophyll data}
chlorodata<-readr::read_csv(here("data/indychlorono22.csv"))
chlorodata$chaoborus<-as.factor(chlorodata$chaoborus)
chlorodata$time<- chlorodata$time+1
chlorodata$time<-as.factor(chlorodata$time)
summary(chlorodata)

chlorodata$metsch <- factor(chlorodata$metsch, levels = c("metsch", "no metsch"),
                  labels = c("Parasites", "No parasites"))


chlorodata$metsch <- factor(chlorodata$metsch, c("No parasites", "Parasites"))

chloroplot <- ggplot(chlorodata,aes(time,y=chlorophyll,group=chaoborus,color=chaoborus,shape=chaoborus)) +
  stat_summary(fun="mean",geom="line",size=1,show.legend=FALSE) +
  stat_summary(fun.data = "mean_cl_boot",show.legend=FALSE) +
  stat_summary(fun="mean",geom="point",size=2,aes(shape=chaoborus)) +
  scale_shape_manual(values=c(15,16,17,18)) +
  labs(color="Predator\ndensity (per L)", shape = "Predator\ndensity (per L)") +
  scale_colour_manual(values=c("#6baed6", "#3182bd", "#08519c","black")) +
  theme_bw()+theme(panel.grid = element_blank()) +
  labs(x="Time (weeks)")+labs(y="Mean chlorophyll \n(ug/L)") +
  theme(axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0))) +
  theme(axis.title.x=element_text(margin=margin(t=10,r=0,b=0,l=0))) +
  facet_grid(rows=vars(metsch))

chloroplot

```

```{r, making figure 3}
figure3 <- plot_grid(eggplot, chloroplot, labels = "auto", ncol = 1)
figure3

ggsave(here("figures", "figure3.jpg"), figure3, units = "in", width = 6, height = 7, dpi = 300)
```

# Clones over time
```{r, import data needed to look at clonal changes over time}
evoldata<-readr::read_csv(here("data/genotype.frequencies_MHC_converted.csv"))
evoldata
#excluding tank 22
evoldata2<-evoldata[!(evoldata$tank=="22"),]
evoldata2$pred<-as.factor(evoldata2$predation)
evoldata2$round<-evoldata2$week+1
evoldata2$roundfactor<-as.factor(evoldata2$round)
summary(evoldata2)
evoldata2$para <- factor(evoldata2$Parasites, levels = c("1", "0"),
                  labels = c("Parasites", "No parasites"))

evoldata2$para <- factor(evoldata2$para, c("No parasites", "Parasites"))
```

```{r, calculating weighted averages}
BD0542inf <- 0.000000079776
BD0846inf <- 9.81E-08
BD1964inf	<- 0
CB2468inf	<- 8.15E-08
DW2258inf	<- 1.69E-07
DW2975inf	<- 1.53E-07
ML3082inf	<- 4.98E-08
ML3284inf	<- 1.37E-07
IL1443inf	<- 1.80E-07
  
evoldata2$infectionmean <- evoldata2$BD05.42*BD0542inf  +
  evoldata2$BD08.46*BD0846inf  +
  evoldata2$BD19.64*BD1964inf  +
  evoldata2$CB24.68*CB2468inf  +
  evoldata2$DW22.58*DW2258inf  +
  evoldata2$DW29.75*DW2975inf  +
  evoldata2$IL14.43*IL1443inf  +
  evoldata2$ML30.82*ML3082inf  +
  evoldata2$ML32.84*ML3284inf
  
BD0542pred  <- 0.0197
BD0846pred  <- 0.0134
BD1964pred	<- 0.0116
CB2468pred	<- 0.0062
DW2258pred	<- 0.0144
DW2975pred	<- 0.0082
ML3082pred	<- 0.0157
ML3284pred	<- 0.0096
IL1443pred	<- 0.016

evoldata2$predationmean <- evoldata2$BD05.42*BD0542pred  +
  evoldata2$BD08.46*BD0846pred  +
  evoldata2$BD19.64*BD1964pred  +
  evoldata2$CB24.68*CB2468pred  +
  evoldata2$DW22.58*DW2258pred  +
  evoldata2$DW29.75*DW2975pred  +
  evoldata2$IL14.43*IL1443pred  +
  evoldata2$ML30.82*ML3082pred  +
  evoldata2$ML32.84*ML3284pred
```

```{r, plotting evolution of infection resistance}
metschresevolplot <- ggplot(evoldata2,aes(round,y=infectionmean,group=pred,color=pred,shape=pred)) + 
  stat_summary(fun="mean",geom="line",size=1,show.legend=FALSE) +
  stat_summary(fun.data = "mean_cl_boot",show.legend=FALSE) +
  stat_summary(fun="mean",geom="point",size=2,aes(shape=pred)) +
  scale_shape_manual(values=c(15,16,17,18)) +
  labs(color="Predator\ndensity (per L)", shape = "Predator\ndensity (per L)") +
  scale_colour_manual(values=c("#6baed6", "#3182bd", "#08519c","black")) +
  theme_bw() +
  theme(panel.grid = element_blank()) +
  labs(x="Time (weeks)") +
  labs(y="Mean infection susceptibility") + 
  scale_x_continuous(breaks=c(0,3,6,9)) +
  theme(axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0))) +
  theme(axis.title.x=element_text(margin=margin(t=10,r=0,b=0,l=0))) +
  facet_grid(rows=vars(para))
metschresevolplot


# ggsave(here("figures", "metschresevolplot.jpg"), metschresevolplot, units = "in", width = 6, height = 3.5, dpi = 300)
```

## Analysis related to Metsch susceptibility evolution
```{r, analysis of Metsch susceptibility evolution}
# removing week 0 for analysis
evoldata3 <- evoldata2 %>%
  filter(round != "0")

#infection susceptibility trait evolution analysis
infsuscmod1<-lme(infectionmean~pred+para+round+pred*para+pred*round+para*round+pred*para*round,random=~1|tank,data=evoldata3)
summary(infsuscmod1)
anova(infsuscmod1)
lsmeans(infsuscmod1,pairwise~round,adjust="tukey")
lsmeans(infsuscmod1,pairwise~para,adjust="tukey")

```

```{r, plotting evolution of infection resistance grouping predation treatments}
metschresevolplotgrouped <- ggplot(evoldata2,aes(round,y=infectionmean,group=para,color=para,shape=para)) + 
  stat_summary(fun="mean",geom="line",size=1,show.legend=FALSE) +
  stat_summary(fun.data = "mean_cl_boot",show.legend=FALSE) +
  stat_summary(fun="mean",geom="point",size=2,aes(shape=para)) +
  scale_shape_manual(values=c(24,25)) +
  labs(color="Parasitism", shape = "Parasitism") +
  scale_colour_manual(values=c("#620D93", "#857A8C")) +
  theme_bw() +
  theme(panel.grid = element_blank()) +
  labs(x="Time (weeks)") +
  labs(y="Mean inf. \nsusceptibility") +
  scale_x_continuous(breaks=c(0,3,6,9)) +
  theme(axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0))) +
  theme(axis.title.x=element_text(margin=margin(t=10,r=0,b=0,l=0))) 
metschresevolplotgrouped

```


## Predation susceptibility
```{r, plotting susceptibility to predation over time}
predresevolplot<-ggplot(evoldata2,aes(round,y=predationmean,group=pred,color=pred,shape=pred)) + 
  stat_summary(fun="mean",geom="line",size=1,show.legend=FALSE) + 
  stat_summary(fun.data = "mean_cl_boot",show.legend=FALSE) +
  stat_summary(fun="mean",geom="point",size=2,aes(shape=pred)) +
  scale_shape_manual(values=c(15,16,17,18)) +
  labs(color="Predator\ndensity (per L)", shape = "Predator\ndensity (per L)") +
  scale_colour_manual(values=c("#6baed6", "#3182bd", "#08519c","black")) +
  theme_bw()+theme(panel.grid = element_blank()) + 
  labs(x="Time (weeks)")+labs(y="Predation susceptibility") +
  theme(axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0))) +
  theme(axis.title.x=element_text(margin=margin(t=10,r=0,b=0,l=0))) +
  scale_x_continuous(breaks=c(0,3,6,9)) +
  facet_grid(rows=vars(para))
predresevolplot


# ggsave(here("figures", "predresevolplot.jpg"), predresevolplot, units = "in", width = 6, height = 3.5, dpi = 300)
```


```{r, analyzing susceptibility to predation over time}
predmod1<-lme(predationmean~pred+para+round+pred*para+pred*round+para*round+pred*para*round,random=~1|tank,data=evoldata3)
summary(predmod1)
anova(predmod1)
lsmeans(predmod1,pairwise~round,adjust="tukey")
lsmeans(predmod1,pairwise~pred,adjust="tukey")
lsmeans(predmod1,pairwise~para,adjust="tukey")
```

```{r, plotting susceptibility to predation over time all on one panel}
predresevolplottogether<-ggplot(evoldata2,aes(round,y=predationmean,group=para,color=para,shape=para)) + 
  stat_summary(fun="mean",geom="line",size=1,show.legend=FALSE) +
  stat_summary(fun.data = "mean_cl_boot",show.legend=FALSE) +
  stat_summary(fun="mean",geom="point",size=2,aes(shape=para)) +
  scale_shape_manual(values=c(24,25)) +
  labs(color="Parasitism", shape = "Parasitism") +
  scale_colour_manual(values=c("#620D93", "#857A8C")) +
  theme_bw() +
  theme(panel.grid = element_blank()) +
  labs(x="Time (weeks)") +
  labs(y="Mean pred. \nsusceptibility") +
  theme(axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0))) +
  scale_x_continuous(breaks=c(0,3,6,9)) +
  theme(axis.title.x=element_text(margin=margin(t=10,r=0,b=0,l=0))) 
predresevolplottogether
```


```{r, making figure 4}
figure4 <- plot_grid(metschresevolplot, predresevolplot, metschresevolplotgrouped, predresevolplottogether, labels = "auto", ncol = 2, rel_heights = c(2, 1))
figure4

ggsave(here("figures", "figure4.jpg"), figure4, units = "in", width = 10, height = 5, dpi = 300)
```




